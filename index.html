<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å¤®æ”¿åºœç¸½é ç®—è§€æ¸¬ç«™ (å¤§åœ°è‰²ç³»ç‰ˆ)</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    
    <style>
        /* --- åŸºç¤è¨­å®š (å…¨æ–°é…è‰²) --- */
        :root {
            /* æ‚¨çš„æŒ‡å®šé…è‰² */
            --bg-color: #fff7e6;       /* æ·ºç±³è‰² (èƒŒæ™¯) */
            --accent-color: #fc8e57;   /* äº®æ©˜è‰² (å¼·èª¿/æŒ‰éˆ•) */
            --secondary-color: #a06a50;/* ç´…è¤è‰² (é‚Šæ¡†/æ¬¡è¦) */
            --primary-color: #55433b;  /* æ·±è¤è‰² (æ–‡å­—/æ¨™é¡Œ) */
            
            /* åŠŸèƒ½æ€§é¡è‰² (ä¿ç•™åŸæ„) */
            --danger-color: #e74c3c;
            --warning-color: #f1c40f;
            --success-color: #2ecc71;
            
            /* æ”¿é»¨ä»£è¡¨è‰² (ä¿ç•™) */
            --party-kmt: #000095;
            --party-dpp: #1b9431;
            --party-tpp: #28c7c7;
            --party-npp: #f9be01;
            --party-other: #95a5a6;
        }
        * { box-sizing: border-box; }
        body { font-family: "Noto Sans TC", sans-serif; background-color: var(--bg-color); margin: 0; line-height: 1.6; color: var(--primary-color); display: flex; flex-direction: column; min-height: 100vh; }
        
        /* Header (èƒŒæ™¯æ”¹ç‚ºæ·ºè‰²ï¼Œæ–‡å­—æ”¹æ·±è‰²) */
        header { 
            background-color: var(--bg-color); 
            color: var(--primary-color); 
            padding: 1rem 2rem; 
            display: flex; justify-content: space-between; align-items: center; 
            position: sticky; top: 0; z-index: 100; 
            box-shadow: 0 2px 10px rgba(85, 67, 59, 0.1); /* é™°å½±æ”¹ç‚ºæ·±è¤è‰²ç³» */
            border-bottom: 2px solid #e6dcc8; /* å¢åŠ åˆ†éš”ç·š */
        }
        header h1 { margin: 0; font-size: 1.4rem; cursor: pointer; white-space: nowrap; font-weight: 900; letter-spacing: 1px; }
        
        /* Nav Buttons */
        header nav { display: flex; gap: 10px; }
        header nav button { 
            background: transparent; 
            border: 1px solid var(--secondary-color); 
            color: var(--primary-color); 
            padding: 6px 12px; cursor: pointer; border-radius: 6px; font-size: 0.9rem; transition: 0.2s; 
            font-weight: bold;
        }
        header nav button:hover { 
            background: var(--accent-color); 
            color: white; 
            border-color: var(--accent-color);
            transform: translateY(-1px); 
        }
        .nav-active { 
            background: var(--primary-color) !important; 
            color: white !important; 
            border-color: var(--primary-color) !important; 
        }
        @media (max-width: 680px) { header { flex-direction: column; gap: 15px; padding: 1rem; } header nav { width: 100%; justify-content: center; flex-wrap: wrap; } header nav button { flex: 1; min-width: 80px; text-align: center; } }

        /* Main */
        main { padding: 2rem; max-width: 1200px; margin: 0 auto; flex: 1; width: 100%; }
        .page-section { display: none; animation: fadeIn 0.4s; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Footer (èƒŒæ™¯æ”¹æ·ºè‰²) */
        footer { 
            background-color: var(--bg-color); 
            color: var(--secondary-color); 
            padding: 3rem 1rem; text-align: center; margin-top: auto; font-size: 0.9rem; 
            border-top: 4px solid var(--accent-color); 
        }
        .footer-content { max-width: 800px; margin: 0 auto; }
        .footer-source { margin-bottom: 15px; line-height: 1.8; }
        .footer-disclaimer { 
            background: rgba(252, 142, 87, 0.1); 
            color: #d35400; /* æ·±æ©˜è‰²æ–‡å­— */
            display: inline-block; padding: 8px 15px; border-radius: 8px; 
            border: 1px solid var(--accent-color); 
            font-weight: bold; margin-top: 10px; 
        }

        /* Dashboard & Components */
        .section-title { text-align: center; margin: 3rem 0 1.5rem 0; color: var(--primary-color); position: relative; }
        .section-title::after { content: ''; display: block; width: 60px; height: 4px; background: var(--accent-color); margin: 10px auto 0; border-radius: 2px; }
        
        /* å¡ç‰‡ç¶­æŒç™½è‰²ï¼Œä½†é™°å½±å’Œé‚Šæ¡†å¾®èª¿ */
        .card { 
            background: white; 
            padding: 1.5rem; border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(160, 106, 80, 0.1); 
            margin-bottom: 2rem; overflow: hidden; 
            border: 1px solid #f0e6d8;
        }
        .chart-container { position: relative; height: 350px; width: 100%; }
        
        /* æŒ‰éˆ•ç¾¤çµ„ */
        .btn-group { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin: 1rem 0 3rem 0; }
        .big-btn { 
            padding: 2rem; width: 250px; border: none; border-radius: 12px; cursor: pointer; 
            color: white; font-weight: bold; font-size: 1.2rem; display: flex; flex-direction: column; align-items: center; transition: transform 0.2s; 
            box-shadow: 0 4px 6px rgba(85, 67, 59, 0.2);
        }
        .big-btn:hover { transform: translateY(-5px); box-shadow: 0 8px 12px rgba(85, 67, 59, 0.3); }
        
        /* èª¿æ•´æŒ‰éˆ•é¡è‰²ä»¥ç¬¦åˆæ–°è‰²ç¥¨ */
        .btn-a { background: linear-gradient(135deg, #fc8e57, #ff7043); } /* æ©˜è‰²ç³» */
        .btn-b { background: linear-gradient(135deg, #a06a50, #8d5d45); } /* ç´…è¤è‰²ç³» */
        .btn-c { background: linear-gradient(135deg, #55433b, #3e302b); } /* æ·±è¤è‰²ç³» */
        
        /* Search */
        .search-wrapper { margin: 2rem 0; text-align: center; width: 100%; }
        .search-input-lg { 
            width: 100%; max-width: 600px; padding: 15px 25px; font-size: 1.1rem; 
            border: 2px solid #e0e0e0; border-radius: 50px; outline: none; transition: 0.3s; 
            background-color: white; color: var(--primary-color);
        }
        .search-input-lg:focus { border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(252, 142, 87, 0.2); }
        
        /* Project Block */
        .project-block { 
            background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; 
            box-shadow: 0 2px 5px rgba(160, 106, 80, 0.1); transition: transform 0.2s; 
            display: grid; grid-template-columns: 1fr auto; gap: 15px; cursor: pointer; 
            border-left: 5px solid var(--accent-color);
            border: 1px solid #f0e6d8; border-left-width: 5px;
        }
        .project-block:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(160, 106, 80, 0.2); }
        .pb-info { display:flex; flex-direction:column; justify-content:center; min-width: 0; }
        .pb-title { font-size: 1.2rem; font-weight: bold; color: var(--primary-color); margin: 0 0 5px 0; word-break: break-word; }
        .pb-dept { background: #fdf2e9; color: var(--secondary-color); padding: 4px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; width: fit-content; }
        .pb-amount { font-size: 1.4rem; color: #d35400; font-weight: 800; white-space: nowrap; text-align: right; }
        
        /* Ranking */
        .ranking-container { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem; }
        .rank-column h3 { border-bottom: 2px solid #eee; padding-bottom: 10px; color: var(--primary-color); }
        .rank-group { margin-bottom: 30px; }
        .rank-group h4 { margin: 10px 0; color: var(--secondary-color); font-size: 1rem; }
        .rank-list { list-style: none; padding: 0; }
        .rank-list li { padding: 12px; border-bottom: 1px dashed #eee; display: flex; justify-content: space-between; color: var(--primary-color); }
        .rank-idx { background: var(--accent-color); color: white; width: 24px; height: 24px; text-align: center; border-radius: 50%; display:inline-block; margin-right:5px;}
        .color-cut { color: var(--danger-color); font-weight:bold; }
        .color-freeze { color: var(--warning-color); font-weight:bold; }

        /* Unified Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(85, 67, 59, 0.7); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; width: 95%; max-width: 900px; max-height: 90vh; border-radius: 15px; padding: 0; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3); animation: slideUp 0.3s ease-out; position:relative; display: flex; flex-direction: column; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .modal-header-area { padding: 25px 25px 15px 25px; border-bottom: 1px solid #f0e6d8; position: relative; background: #fffcf5; }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 2.5rem; cursor: pointer; color: var(--secondary-color); line-height: 0.8; z-index: 10; transition:0.2s; }
        .close-btn:hover { color: var(--accent-color); }
        
        /* Modal Tabs */
        .modal-tabs { display: flex; background: #fdf2e9; border-bottom: 1px solid #e6dcc8; }
        .modal-tab { flex: 1; text-align: center; padding: 15px; cursor: pointer; font-weight: bold; color: var(--secondary-color); border-bottom: 3px solid transparent; transition: 0.3s; }
        .modal-tab:hover { background: #fae5d3; }
        .modal-tab.active { color: var(--primary-color); border-bottom-color: var(--accent-color); background: white; }
        
        .modal-body-area { padding: 25px; overflow-y: auto; max-height: calc(90vh - 150px); }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }

        /* Modal Charts Single Column */
        .modal-charts-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 20px; }
        .mini-chart-box { text-align: center; background: #fff; padding: 15px; border: 1px solid #f0e6d8; border-radius: 8px; }
        
        /* Loading */
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,247,230,0.9); z-index: 999; justify-content: center; align-items: center; flex-direction: column; }
        .spinner { border: 8px solid #e6dcc8; border-top: 8px solid var(--accent-color); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        
        /* Table & Tags */
        .proposal-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.95rem; }
        .proposal-table th, .proposal-table td { padding: 12px; text-align: left; border-bottom: 1px solid #f0e6d8; }
        .proposal-table th { background-color: #fdf2e9; color: var(--primary-color); }
        .p-tag { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; margin-right: 5px; color: white;}
        .p-cut { background: var(--danger-color); }
        .p-freeze { background: var(--warning-color); }
        .jump-btn { background: linear-gradient(135deg, #fc8e57, #ff7043); color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 0.95rem; margin-top: 10px; display: inline-flex; align-items: center; transition: 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .jump-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
        .jump-btn::after { content: ' â”'; margin-left: 5px; }

        /* Legislator Styles */
        .filter-wrapper { text-align: center; margin-bottom: 25px; }
        .filter-btn-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-top: 10px; }
        .filter-tag { border: 1px solid #e6dcc8; background: white; color: var(--primary-color); padding: 6px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9rem; font-weight: bold; transition: 0.2s; }
        .filter-tag:hover { background: #fdf2e9; border-color: var(--accent-color); }
        .filter-tag.active { background: var(--primary-color); color: white; border-color: var(--primary-color); box-shadow: 0 2px 5px rgba(85, 67, 59, 0.3); }

        .legislator-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 25px; margin-top: 20px; }
        .leg-card { background: white; border-radius: 15px; padding: 25px; text-align: center; box-shadow: 0 4px 10px rgba(160, 106, 80, 0.1); transition: 0.3s; display: flex; flex-direction: column; align-items: center; cursor: pointer; border: 1px solid #f0e6d8; }
        .leg-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(160, 106, 80, 0.2); border-color: var(--accent-color); }
        .leg-avatar { width: 100px; height: 100px; border-radius: 50%; background-color: #fdf2e9; margin-bottom: 15px; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; font-size: 3rem; overflow: hidden; background-size: cover; background-position: center; }
        .leg-name { font-size: 1.4rem; font-weight: bold; margin-bottom: 5px; color: var(--primary-color); }
        .leg-party-tag { padding: 4px 12px; border-radius: 15px; color: white; font-size: 0.85rem; font-weight: bold; margin-bottom: 20px; display: inline-block; }
        .tag-kmt { background-color: var(--party-kmt); }
        .tag-dpp { background-color: var(--party-dpp); }
        .tag-tpp { background-color: var(--party-tpp); }
        .tag-npp { background-color: var(--party-npp); }
        .tag-other { background-color: var(--party-other); }
        .leg-stats-box { display: flex; justify-content: space-between; width: 100%; border-top: 1px solid #eee; padding-top: 15px; }
        .stat-item { flex: 1; text-align: center; }
        .stat-item:not(:last-child) { border-right: 1px solid #eee; }
        .stat-val { display: block; font-size: 1.2rem; font-weight: 800; color: #333; }
        .stat-label { font-size: 0.8rem; color: #888; }

        /* Modal C Specific */
        .leg-modal-body { padding: 30px; overflow-y: auto; max-height: 90vh; }
        .leg-detail-header { text-align: center; margin-bottom: 30px; }
        .leg-detail-avatar { width: 120px; height: 120px; border-radius: 50%; background-color: #fdf2e9; margin: 0 auto 15px; border: 4px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.15); background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; font-size: 4rem; }
        .leg-detail-table-title { border-left: 5px solid var(--accent-color); padding-left: 10px; margin: 30px 0 15px 0; color: var(--primary-color); }
        .title-cut { border-color: var(--danger-color); }
        .title-freeze { border-color: var(--warning-color); }
        .clickable-link { color: var(--accent-color); cursor: pointer; text-decoration: underline; font-weight: bold; transition: 0.2s; }
        .clickable-link:hover { color: #d35400; background-color: #fdf2e9; border-radius: 4px; padding: 0 4px; }

        @media (max-width: 768px) {
            main { padding: 1rem; }
            .btn-group { flex-direction: column; gap: 15px; }
            .big-btn { width: 100%; }
            .chart-container { height: 250px; }
            .ranking-container { grid-template-columns: 1fr; gap: 20px; }
            .modal-charts-grid { grid-template-columns: 1fr; }
            .search-input-lg { font-size: 16px; padding: 12px 20px; }
            .project-block { grid-template-columns: 1fr; gap: 10px; }
            .pb-amount { text-align: left; margin-left: 0; font-size: 1.2rem; }
            .legislator-grid { grid-template-columns: 1fr; }
            .leg-modal-body { padding: 20px; }
        }
    </style>
</head>
<body>

    <div id="loader" class="loading-overlay"><div class="spinner"></div><p style="margin-top:15px; color:#555;">è³‡æ–™è®€å–ä¸­ï¼Œè«‹ç¨å€™...</p></div>

    <div id="unifiedModal" class="modal-overlay" onclick="closeModal(event, 'unifiedModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModal(null, 'unifiedModal')">&times;</span>
            <div class="modal-header-area">
                <h2 id="u-title" style="margin:0; color:var(--primary-color);"></h2>
                <div style="margin-top:5px; color:#666;">
                    <span id="u-dept" class="pb-dept"></span>
                    <span id="u-amount" style="font-weight:bold; color:var(--danger-color); margin-left:10px;"></span>
                </div>
            </div>
            <div class="modal-tabs">
                <div class="modal-tab active" onclick="switchTab('plan')">ğŸ“„ å·¥ä½œè¨ˆç•«å…§å®¹</div>
                <div class="modal-tab" onclick="switchTab('review')">âš–ï¸ å¯©æŸ¥åˆªæ¸›çµæœ</div>
            </div>
            <div class="modal-body-area">
                <div id="tab-content-plan" class="tab-content active">
                    <div style="background:#fdf2e9; padding:15px; border-radius:8px; margin-bottom:20px; border:1px solid #f0e6d8;">
                        <strong>ğŸ“ å…§å®¹ï¼š</strong> <span id="u-desc"></span>
                    </div>
                    <div class="modal-charts-grid">
                        <div class="mini-chart-box"><h4>ğŸ“Š åˆ†æ”¯è¨ˆç•«</h4><div style="height:250px;"><canvas id="chartDetailBar"></canvas></div></div>
                        <div class="mini-chart-box"><h4>ğŸ° ç”¨é€”æ¯”ä¾‹</h4><div style="height:250px;"><canvas id="chartDetailPie"></canvas></div></div>
                    </div>
                </div>
                <div id="tab-content-review" class="tab-content">
                    <div id="review-data-container">
                        <div class="modal-charts-grid">
                            <div class="mini-chart-box"><h4>âœ‚ï¸ æœ€çµ‚å¯©æŸ¥çµæœæ¯”ä¾‹</h4><div style="height:250px;"><canvas id="chartBResult"></canvas></div></div>
                            <div class="mini-chart-box"><h4>âš–ï¸ ä¸‰éšæ®µåˆªå‡æ¯”è¼ƒ</h4><div style="height:250px;"><canvas id="chartBStages"></canvas></div></div>
                        </div>
                        <div style="margin-top: 30px;">
                            <h3 style="border-left: 5px solid var(--accent-color); padding-left: 10px;">ğŸ“„ å§”å“¡ææ¡ˆç´€éŒ„</h3>
                            <div style="overflow-x: auto;">
                                <table class="proposal-table">
                                    <thead><tr><th style="width:15%">ææ¡ˆå§”å“¡</th><th style="width:20%">é¡åˆ¥/é‡‘é¡</th><th>ææ¡ˆç†ç”±</th></tr></thead>
                                    <tbody id="proposal-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="review-no-data" style="display:none; text-align:center; padding: 2rem; color:#888;">
                        <p>æ­¤è¨ˆç•«å°šç„¡å¯©æŸ¥åˆªæ¸›è³‡æ–™ã€‚</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="detailModalC" class="modal-overlay" onclick="closeModal(event, 'detailModalC')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-btn" onclick="closeModal(null, 'detailModalC')">&times;</span>
            <div class="leg-modal-body">
                <div class="leg-detail-header">
                    <div id="mc-avatar" class="leg-detail-avatar"></div>
                    <h2 id="mc-name" style="color:var(--primary-color); margin-bottom:5px;"></h2>
                    <span id="mc-party" class="leg-party-tag"></span>
                </div>
                <h3 class="leg-detail-table-title title-cut">âœ‚ï¸ åˆªæ¸›æ¡ˆææ¡ˆç´€éŒ„</h3>
                <div style="overflow-x: auto;">
                    <table class="proposal-table">
                        <thead><tr><th style="width:30%">åˆªæ¸›é …ç›®</th><th style="width:20%">åˆªæ¸›é‡‘é¡/æ¯”ä¾‹</th><th>åˆªæ¸›ç†ç”±</th></tr></thead>
                        <tbody id="table-cut-c"></tbody>
                    </table>
                </div>
                <h3 class="leg-detail-table-title title-freeze">â„ï¸ å‡çµæ¡ˆææ¡ˆç´€éŒ„</h3>
                <div style="overflow-x: auto;">
                    <table class="proposal-table">
                        <thead><tr><th style="width:30%">å‡çµé …ç›®</th><th style="width:20%">å‡çµé‡‘é¡/æ¯”ä¾‹</th><th>å‡çµç†ç”±</th></tr></thead>
                        <tbody id="table-freeze-c"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <header>
        <h1 onclick="showPage('home')">ğŸ“Š ä¸­å¤®æ”¿åºœç¸½é ç®—è§€æ¸¬ç«™</h1>
        <nav>
            <button id="nav-home" onclick="showPage('home')">é¦–é </button>
            <button id="nav-budget" onclick="showPage('page-budget')">é ç®—å¯©æŸ¥</button>
            <button id="nav-legislator" onclick="showPage('page-legislator')">ç«‹å§”æŠŠé—œ</button>
        </nav>
    </header>

    <main>
        <section id="home" class="page-section active">
            <div class="hero">
                <h2 style="text-align: center; margin-bottom: 2rem; color:var(--primary-color);">æ¯ä¸€ç­†ç´ç¨…éŒ¢ï¼Œéƒ½å€¼å¾—è¢«çœ‹è¦‹</h2>
            </div>
            
            <div class="card">
                <h3>ç¸½é ç®—å¯©æŸ¥æ¯”ä¾‹æ¦‚æ³</h3>
                <div style="height: 100px;"><canvas id="chartStatusB"></canvas></div>
                <div style="text-align:center; font-size:0.9rem; color:#666; margin-top:10px;">èªªæ˜ï¼šæ­¤åœ–è¡¨åŒ…å«å„å·¥ä½œè¨ˆç•«åˆªæ¸›èˆ‡éƒ¨æœƒé€šæ¡ˆåˆªæ¸›ä¹‹ç¸½å’Œã€‚</div>
            </div>

            <div class="btn-group">
                <button class="big-btn btn-a" onclick="showPage('page-budget')">é–‹å§‹æœå°‹<br>é ç®—èˆ‡å¯©æŸ¥å…§å®¹</button>
                <button class="big-btn btn-c" onclick="showPage('page-legislator')">é–‹å§‹æœå°‹<br>ç«‹å§”æŠŠé—œç´€éŒ„</button>
            </div>

            <div class="ranking-container">
                <div class="card rank-column">
                    <h3>ğŸ›ï¸ éƒ¨æœƒæ©Ÿé—œ Top 5</h3>
                    <div class="rank-group"><h4>âœ‚ï¸ åˆªæ¸›é‡‘é¡æœ€å¤š</h4><ul class="rank-list" id="rank-dept-cut"></ul></div>
                    <div class="rank-group"><h4>â„ï¸ å‡çµé‡‘é¡æœ€å¤š</h4><ul class="rank-list" id="rank-dept-freeze"></ul></div>
                </div>
                <div class="card rank-column">
                    <h3>ğŸ“‹ å·¥ä½œè¨ˆç•« Top 5</h3>
                    <div class="rank-group"><h4>âœ‚ï¸ åˆªæ¸›é‡‘é¡æœ€å¤š</h4><ul class="rank-list" id="rank-plan-cut"></ul></div>
                    <div class="rank-group"><h4>â„ï¸ å‡çµé‡‘é¡æœ€å¤š</h4><ul class="rank-list" id="rank-plan-freeze"></ul></div>
                </div>
            </div>
            <div class="card">
                <h3>æ­·å¹´æ­²å‡ºé ç®—æ¯”è¼ƒ</h3>
                <div class="chart-container"><canvas id="chartYearly"></canvas></div>
            </div>
            <div class="card">
                <h3>115 å¹´åº¦é ç®—åˆ†é…æ¦‚æ³</h3>
                <div class="chart-container" style="height: 120px;"><canvas id="chartAllocation"></canvas></div>
            </div>
        </section>

        <section id="page-budget" class="page-section">
            <h2 class="section-title">ğŸ” é ç®—è¨ˆç•«èˆ‡å¯©æŸ¥çµæœæœå°‹</h2>
            <div class="search-wrapper"><input type="text" class="search-input-lg" placeholder="è¼¸å…¥é—œéµå­— (å¦‚: åœ‹é˜², æ½›è‰¦, å‡çµ...)" oninput="handleSearchBudget(this.value)"></div>
            <div id="results-container-budget"><p align="center" style="color:#666; padding:20px;">è«‹è¼¸å…¥é—œéµå­—é–‹å§‹æœå°‹...</p></div>
        </section>

        <section id="page-legislator" class="page-section">
            <h2 class="section-title">âš–ï¸ ç«‹å§”æŠŠé—œç´€éŒ„</h2>
            
            <div class="filter-wrapper">
                <span style="font-weight:bold; color:var(--secondary-color);">ä¾é»¨ç±ç¯©é¸ï¼š</span>
                <div class="filter-btn-group">
                    <button class="filter-tag active" data-party="all" onclick="filterLegislators('all')">å…¨éƒ¨</button>
                    <button class="filter-tag" data-party="æ°‘é€²é»¨" onclick="filterLegislators('æ°‘é€²é»¨')">æ°‘é€²é»¨</button>
                    <button class="filter-tag" data-party="åœ‹æ°‘é»¨" onclick="filterLegislators('åœ‹æ°‘é»¨')">åœ‹æ°‘é»¨</button>
                    <button class="filter-tag" data-party="æ°‘çœ¾é»¨" onclick="filterLegislators('æ°‘çœ¾é»¨')">æ°‘çœ¾é»¨</button>
                    <button class="filter-tag" data-party="æ™‚ä»£åŠ›é‡" onclick="filterLegislators('æ™‚ä»£åŠ›é‡')">æ™‚ä»£åŠ›é‡</button>
                    <button class="filter-tag" data-party="ç„¡é»¨ç±" onclick="filterLegislators('ç„¡é»¨ç±')">ç„¡é»¨ç±</button>
                </div>
            </div>

            <div class="card">
                <p style="text-align:center; color:#666;">é»æ“Šå§”å“¡å¡ç‰‡å¯æŸ¥çœ‹è©³ç´°ææ¡ˆå…§å®¹</p>
                <div class="legislator-grid" id="leg-container-c"></div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p class="footer-source"><strong>è³‡æ–™ä¾†æºï¼š</strong>å„æ©Ÿé—œå®˜ç¶²ã€ä¸»è¨ˆç¸½è™•ã€ç«‹æ³•é™¢è­°äº‹æš¨å…¬å ±ç¶²</p>
            <div class="footer-disclaimer">âš ï¸ å…è²¬è²æ˜ï¼šç¶²ç«™ç‚ºæ¸¬è©¦ç‰ˆï¼Œä¸¦éæœ€çµ‚è³‡æ–™ï¼Œåƒ…ä¾›åƒè€ƒ</div>
        </div>
    </footer>

    <script>
        const dataSources = {
            'page-a': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS6ZFEMdgBFyC6O0Axmx7TvcckTzMoDCxrb5V_8gHJmyzBEXx-cLj6RtRWkyUUap-qiK_C2G-GwJFMJ/pub?gid=612819456&single=true&output=csv', 
            'page-b': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS6ZFEMdgBFyC6O0Axmx7TvcckTzMoDCxrb5V_8gHJmyzBEXx-cLj6RtRWkyUUap-qiK_C2G-GwJFMJ/pub?gid=1304436957&single=true&output=csv', 
            'page-c': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS6ZFEMdgBFyC6O0Axmx7TvcckTzMoDCxrb5V_8gHJmyzBEXx-cLj6RtRWkyUUap-qiK_C2G-GwJFMJ/pub?gid=1025885437&single=true&output=csv' 
        };
        
        let allDataPageA = [], allDataPageB = [], allDataPageB_Plans = [], allDataPageC = []; 
        let mainChartsRendered = false;

        window.addEventListener('DOMContentLoaded', () => {
            renderMainCharts();
            fetchData('page-a', true);
            fetchData('page-b', true); 
            fetchData('page-c', true);
        });

        // =======================
        // â˜…â˜…â˜… æ ¸å¿ƒå·¥å…·èˆ‡æ¸²æŸ“å‡½å¼ (æ”¾ç½®æœ€å‰) â˜…â˜…â˜…
        // =======================

        function parseMoney(str) {
            if(!str) return 0;
            let s = str + '';
            let val = parseFloat(s.replace(/,/g, '').replace(/[^0-9.-]/g, ''));
            if (isNaN(val)) return 0;
            if (s.includes('å„„')) return val * 100000000;
            else if (s.includes('è¬')) return val * 10000;
            else return val * 1000;
        }
        function formatCurrency(num) {
            let val = parseFloat(num);
            if (isNaN(val) || val === 0) return "0";
            let absVal = Math.abs(val);
            if (absVal >= 1000000000000) return (val / 1000000000000).toFixed(1).replace(/\.0$/, '') + "å…†";
            else if (absVal >= 100000000) return (val / 100000000).toFixed(1).replace(/\.0$/, '') + "å„„";
            else if (absVal >= 10000) return (val / 10000).toFixed(1).replace(/\.0$/, '') + "è¬";
            else return val.toLocaleString() + "å…ƒ";
        }
        const tooltipCurrencyCallback = {
            callbacks: {
                label: function(context) {
                    let label = context.dataset.label || '';
                    if (label) { label += ': '; }
                    let value = context.raw;
                    if (value !== null && value !== undefined) { label += formatCurrency(value); }
                    return label;
                }
            }
        };

        // æ¸²æŸ“ææ¡ˆè¡¨æ ¼
        function renderProposalTable(row){
            const tbody=document.getElementById('proposal-table-body');
            tbody.innerHTML='';
            const proposalStr=row['ææ¡ˆç´€éŒ„']||'';
            if(!proposalStr){tbody.innerHTML='<tr><td colspan="3" style="text-align:center">æš«ç„¡è©³ç´°ææ¡ˆè³‡æ–™</td></tr>';return}
            proposalStr.split('|').forEach(p=>{
                const parts=p.split(':');
                if(parts.length>=3){
                    const typeClass=parts[1].includes('åˆª')?'p-cut':'p-freeze';
                    const legName=parts[0].trim();
                    const nameHtml=`<span class="clickable-link" onclick="jumpToC('${legName}')">${legName}</span>`;
                    tbody.innerHTML+=`<tr><td><strong>${nameHtml}</strong></td><td><span class="p-tag ${typeClass}">${parts[1]}</span></td><td>${parts[2]}</td></tr>`
                }
            })
        }

        // æ¸²æŸ“ç«‹å§”è©³ç´°è¡¨æ ¼
        function renderLegislatorTables(detailStr) {
            const tableCut = document.getElementById('table-cut-c');
            const tableFreeze = document.getElementById('table-freeze-c');
            tableCut.innerHTML = ''; tableFreeze.innerHTML = '';
            if(!detailStr) {
                const emptyRow = '<tr><td colspan="3" style="text-align:center; color:#999;">ç„¡è©³ç´°è³‡æ–™</td></tr>';
                tableCut.innerHTML = emptyRow; tableFreeze.innerHTML = emptyRow; return;
            }
            const items = detailStr.split('|');
            let hasCut = false, hasFreeze = false;
            items.forEach(item => {
                const parts = item.split('#');
                if(parts.length >= 4) {
                    const type = parts[0].trim();
                    const projectId = parts[4] ? parts[4].trim() : '';
                    let nameHtml = parts[1].trim();
                    if(projectId) {
                        nameHtml = `<span class="clickable-link" onclick="jumpToProjectB('${projectId}')">${nameHtml}</span>`;
                    }
                    const rowHtml = `<tr><td>${nameHtml}</td><td>${parts[2].trim()}</td><td>${parts[3].trim()}</td></tr>`;
                    if(type.includes('åˆª')) { tableCut.innerHTML += rowHtml; hasCut = true; } 
                    else if(type.includes('å‡')) { tableFreeze.innerHTML += rowHtml; hasFreeze = true; }
                }
            });
            if(!hasCut) tableCut.innerHTML = '<tr><td colspan="3" style="text-align:center; color:#999;">ç„¡åˆªæ¸›ææ¡ˆ</td></tr>';
            if(!hasFreeze) tableFreeze.innerHTML = '<tr><td colspan="3" style="text-align:center; color:#999;">ç„¡å‡çµææ¡ˆ</td></tr>';
        }

        // é–‹å•Ÿç«‹å§”è©³æƒ… Modal
        function openDetailC(str) {
            const row = JSON.parse(decodeURIComponent(str));
            const modal = document.getElementById('detailModalC');
            document.getElementById('mc-name').innerText = row['å§”å“¡å§“å'];
            document.getElementById('mc-party').innerText = row['é»¨ç±'];
            let partyClass = 'tag-other';
            const party = row['é»¨ç±'] || '';
            if(party.includes('æ°‘é€²'))partyClass='tag-dpp';else if(party.includes('åœ‹æ°‘'))partyClass='tag-kmt';else if(party.includes('æ°‘çœ¾'))partyClass='tag-tpp';else if(party.includes('æ™‚ä»£'))partyClass='tag-npp';
            document.getElementById('mc-party').className = `leg-party-tag ${partyClass}`;
            const photoUrl = row['ç…§ç‰‡'] || '';
            const avatarDiv = document.getElementById('mc-avatar');
            if(photoUrl && photoUrl.startsWith('http')) {
                avatarDiv.innerHTML = ''; avatarDiv.style.backgroundImage = `url('${photoUrl}')`;
            } else {
                avatarDiv.style.backgroundImage = ''; avatarDiv.innerHTML = 'ğŸ§‘â€ğŸ’¼';
            }
            renderLegislatorTables(row['ææ¡ˆæ˜ç´°'] || '');
            modal.style.display = 'flex';
        }

        // æ¸²æŸ“ç«‹å§”å¡ç‰‡
        function renderLegislatorGrid(data) {
            const container = document.getElementById('leg-container-c');
            if(!data || data.length === 0) { container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #777;">ç„¡è³‡æ–™</p>'; return; }
            let html = '';
            data.forEach(row => {
                const name = row['å§”å“¡å§“å'] || 'æœªçŸ¥å§”å“¡';
                const party = row['é»¨ç±'] || 'ç„¡é»¨ç±';
                const photoUrl = row['ç…§ç‰‡'] || '';
                let partyClass = 'tag-other';
                if(party.includes('æ°‘é€²'))partyClass='tag-dpp';else if(party.includes('åœ‹æ°‘'))partyClass='tag-kmt';else if(party.includes('æ°‘çœ¾'))partyClass='tag-tpp';else if(party.includes('æ™‚ä»£'))partyClass='tag-npp';
                let avatarHtml='ğŸ§‘â€ğŸ’¼';
                if(photoUrl&&photoUrl.startsWith('http')){avatarHtml=`<div style="width:100%; height:100%; border-radius:50%; background-image:url('${photoUrl}'); background-size:cover; background-position:center;"></div>`}
                const rowStr=encodeURIComponent(JSON.stringify(row));
                html+=`<div class="leg-card" onclick="openDetailC('${rowStr}')"><div class="leg-avatar">${avatarHtml}</div><div class="leg-name">${name}</div><span class="leg-party-tag ${partyClass}">${party}</span><div class="leg-stats-box"><div class="stat-item"><span class="stat-val" style="color:var(--danger-color);">${row['åˆªæ¸›æ¡ˆæ•¸']||0}</span><span class="stat-label">åˆªæ¸›æ¡ˆ</span></div><div class="stat-item"><span class="stat-val" style="color:var(--warning-color);">${row['å‡çµæ¡ˆæ•¸']||0}</span><span class="stat-label">å‡çµæ¡ˆ</span></div><div class="stat-item"><span class="stat-val" style="color:var(--primary-color);">${row['ä¸»æ±ºè­°æ•¸']||0}</span><span class="stat-label">ä¸»æ±ºè­°</span></div></div></div>`
            });
            container.innerHTML = html;
        }

        // =======================
        // â˜…â˜…â˜… æ¥­å‹™é‚è¼¯å‡½å¼å€ â˜…â˜…â˜…
        // =======================

        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);
            document.querySelectorAll('header nav button').forEach(b => b.classList.remove('nav-active'));
            if(pageId === 'home') document.getElementById('nav-home').classList.add('nav-active');
            if(pageId === 'page-budget') document.getElementById('nav-budget').classList.add('nav-active');
            if(pageId === 'page-legislator') document.getElementById('nav-legislator').classList.add('nav-active');
            if (pageId === 'page-legislator' && allDataPageC.length === 0) fetchData('page-c');
        }

        function fetchData(pageId, silent = false) {
            return new Promise((resolve, reject) => {
                let rawUrl = dataSources[pageId];
                if(pageId === 'page-budget') rawUrl = null; 
                if(pageId === 'page-legislator') rawUrl = dataSources['page-c'];
                if (!rawUrl) { 
                    if(pageId === 'page-a') rawUrl = dataSources['page-a'];
                    else if(pageId === 'page-b') rawUrl = dataSources['page-b'];
                    else { resolve([]); return; }
                }
                const cacheBuster = '&t=' + new Date().getTime();
                const finalUrl = 'https://corsproxy.io/?' + encodeURIComponent(rawUrl + cacheBuster);
                const loader = document.getElementById('loader');
                if (!silent) loader.style.display = 'flex';
                console.log(`[${pageId}] Loading data from: ${finalUrl}`);
                Papa.parse(finalUrl, {
                    download: true, header: true, skipEmptyLines: true, transformHeader: function(h) { return h.trim(); },
                    complete: function(results) {
                        let cleanData = results.data.map(row => {
                            let newRow = {}; for (let key in row) { newRow[key] = row[key] ? row[key].trim() : ''; } return newRow;
                        });
                        if (pageId === 'page-a') { allDataPageA = cleanData; } 
                        else if (pageId === 'page-b') { allDataPageB = cleanData; processPageBData(allDataPageB); } 
                        else if (pageId === 'page-c') { 
                            allDataPageC = cleanData; 
                            filterLegislators('all');
                        }
                        if (!silent) loader.style.display = 'none';
                        resolve(cleanData);
                    },
                    error: function(err) { if (!silent) { loader.style.display = 'none'; alert('è³‡æ–™è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Consoleã€‚'); } reject(err); }
                });
            });
        }

        function filterLegislators(party) {
            document.querySelectorAll('.filter-tag').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.party === party) btn.classList.add('active');
            });
            let filtered = [];
            if (party === 'all') { filtered = allDataPageC; } 
            else { filtered = allDataPageC.filter(r => (r['é»¨ç±'] || '').includes(party)); }
            renderLegislatorGrid(filtered);
        }

        function processPageBData(data){
            let totalCut=0,totalFreeze=0,totalBudget=0;let deptStats={};allDataPageB_Plans=[];
            data.forEach(row=>{
                const amount=parseMoney(row['é ç®—é‡‘é¡']);const cut=parseMoney(row['åˆªæ¸›é‡‘é¡']);const freeze=parseMoney(row['å‡çµé‡‘é¡']);const dept=row['ä¸»ç®¡æ©Ÿé—œ']||'å…¶ä»–';const type=row['è³‡æ–™é¡å‹']||'è¨ˆç•«';
                totalBudget+=amount;totalCut+=cut;totalFreeze+=freeze;
                if(!deptStats[dept])deptStats[dept]={name:dept,cut:0,freeze:0};deptStats[dept].cut+=cut;deptStats[dept].freeze+=freeze;
                if(type==='è¨ˆç•«'){allDataPageB_Plans.push(row)}
            });
            const totalPass=totalBudget-totalCut-totalFreeze;
            const ctxStatus = document.getElementById('chartStatusB');
            if (ctxStatus) {
                new Chart(ctxStatus.getContext('2d'),{type:'bar',data:{labels:['ç¸½é«”å¯©æŸ¥çµæœ'],datasets:[{label:'é€šé',data:[totalPass],backgroundColor:'#2ecc71',barThickness:40},{label:'å‡çµ',data:[totalFreeze],backgroundColor:'#f1c40f',barThickness:40},{label:'åˆªæ¸›',data:[totalCut],backgroundColor:'#e74c3c',barThickness:40}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,scales:{x:{stacked:true,display:false},y:{stacked:true,display:false}},plugins:{legend:{position:'top'},tooltip:tooltipCurrencyCallback}}});
            }
            const deptArray=Object.values(deptStats);renderRankList('rank-dept-cut',[...deptArray].sort((a,b)=>b.cut-a.cut).slice(0,5),'cut');renderRankList('rank-dept-freeze',[...deptArray].sort((a,b)=>b.freeze-a.freeze).slice(0,5),'freeze');
            const planArray=allDataPageB_Plans.map(r=>({name:r['è¨ˆç•«åç¨±'],cut:parseMoney(r['åˆªæ¸›é‡‘é¡']),freeze:parseMoney(r['å‡çµé‡‘é¡'])})).filter(r=>r.name);renderRankList('rank-plan-cut',[...planArray].sort((a,b)=>b.cut-a.cut).slice(0,5),'cut');renderRankList('rank-plan-freeze',[...planArray].sort((a,b)=>b.freeze-a.freeze).slice(0,5),'freeze');
        }
        function renderRankList(elementId,list,type){const el=document.getElementById(elementId);if(!list||list.length===0){el.innerHTML='<li>ç„¡è³‡æ–™</li>';return}let html='';list.forEach((item,index)=>{let val=type==='cut'?item.cut:item.freeze;let valDisplay=formatCurrency(val);let colorClass=type==='cut'?'color-cut':'color-freeze';html+=`<li><span><span class="rank-idx">${index+1}</span> ${item.name}</span><span class="rank-val ${colorClass}">${valDisplay}</span></li>`});el.innerHTML=html}

        function handleSearchBudget(val) {
            const container = document.getElementById('results-container-budget');
            if (!val.trim()) { 
                container.innerHTML = '<p align="center" style="color:#666; padding:20px;">è«‹è¼¸å…¥é—œéµå­—é–‹å§‹æœå°‹...</p>'; 
                return; 
            }
            const keywords = val.toLowerCase().replace(/\s+and\s+/g, ' ').split(/\s+/).filter(k => k.trim() !== '');
            const filtered = allDataPageA.filter(r => {
                const content = ((r['è¨ˆç•«åç¨±'] || '') + (r['å·¥ä½œå…§å®¹'] || '') + (r['ä¸»ç®¡æ©Ÿé—œ'] || '')).toLowerCase();
                return keywords.every(k => content.includes(k));
            });
            displayUnifiedBlocks(filtered);
        }

        function displayUnifiedBlocks(data){
            const container=document.getElementById('results-container-budget');
            if(!data||data.length===0){container.innerHTML='<p align="center">æŸ¥ç„¡è³‡æ–™</p>';return}
            let html='';
            data.forEach(row=>{
                const id = row['è¨ˆç•«ç·¨è™Ÿ'];
                const amountRaw=parseMoney(row['é ç®—é‡‘é¡']);
                html+=`<div class="project-block" onclick="openUnifiedDetail('${id}')"><div class="pb-info"><h3 class="pb-title">${row['è¨ˆç•«åç¨±']}</h3><span class="pb-dept">${row['ä¸»ç®¡æ©Ÿé—œ']}</span></div><div class="pb-amount">${formatCurrency(amountRaw)}</div></div>`
            });
            container.innerHTML=html;
        }

        let chartBarA = null, chartPieA = null, chartB1 = null, chartB2 = null;
        function openUnifiedDetail(id) {
            const planData = allDataPageA.find(r => r['è¨ˆç•«ç·¨è™Ÿ'] === id);
            const reviewData = allDataPageB.find(r => r['è¨ˆç•«ç·¨è™Ÿ'] === id);
            if (!planData && !reviewData) { alert("è³‡æ–™è®€å–éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°è©²è¨ˆç•« (è«‹æª¢æŸ¥è¨ˆç•«ç·¨è™Ÿæ˜¯å¦æ­£ç¢º)"); return; }
            const baseData = planData || reviewData; 
            document.getElementById('u-title').innerText = baseData['è¨ˆç•«åç¨±'];
            document.getElementById('u-dept').innerText = baseData['ä¸»ç®¡æ©Ÿé—œ'];
            document.getElementById('u-amount').innerText = formatCurrency(parseMoney(baseData['é ç®—é‡‘é¡']));
            
            // Tab A (Plan)
            if (planData) {
                document.getElementById('u-desc').innerText = planData['å·¥ä½œå…§å®¹'] || 'ç„¡';
                if(chartBarA) chartBarA.destroy(); if(chartPieA) chartPieA.destroy();
                renderDetailChartsA(planData);
            } else { document.getElementById('u-desc').innerText = 'æ­¤è¨ˆç•«ç„¡è©³ç´°ç·¨åˆ—å…§å®¹è³‡æ–™ã€‚'; }
            
            // Tab B (Review)
            const reviewContainer = document.getElementById('review-data-container');
            const reviewNoData = document.getElementById('review-no-data');
            if (reviewData) {
                reviewContainer.style.display = 'block'; reviewNoData.style.display = 'none';
                if(chartB1) chartB1.destroy(); if(chartB2) chartB2.destroy();
                renderDetailChartsB(reviewData); 
                renderProposalTable(reviewData);
            } else { reviewContainer.style.display = 'none'; reviewNoData.style.display = 'block'; }
            
            switchTab('plan'); document.getElementById('unifiedModal').style.display = 'flex';
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            if (tabName === 'plan') {
                document.querySelector('.modal-tab:first-child').classList.add('active');
                document.getElementById('tab-content-plan').classList.add('active');
            } else {
                document.querySelector('.modal-tab:last-child').classList.add('active');
                document.getElementById('tab-content-review').classList.add('active');
            }
        }

        async function jumpToProjectB(projectId) {
            const loader = document.getElementById('loader'); loader.style.display = 'flex';
            closeModal(null, 'detailModalC'); showPage('page-budget');
            if(allDataPageA.length === 0) await fetchData('page-a', true);
            if(allDataPageB.length === 0) await fetchData('page-b', true);
            const targetId = String(projectId).trim(); openUnifiedDetail(targetId); switchTab('review');
            loader.style.display = 'none';
        }

        async function jumpToC(name) {
            const loader = document.getElementById('loader'); loader.style.display = 'flex';
            closeModal(null, 'unifiedModal'); 
            if(allDataPageC.length === 0) { try { await fetchData('page-c'); } catch(e) { loader.style.display = 'none'; return; } }
            const targetName = String(name).trim();
            const target = allDataPageC.find(r => String(r['å§”å“¡å§“å']).trim() === targetName);
            loader.style.display = 'none';
            if(target) { const str = encodeURIComponent(JSON.stringify(target)); openDetailC(str); } 
            else { alert(`æŸ¥ç„¡æ­¤å§”å“¡è³‡æ–™ (${targetName})`); }
        }

        function closeModal(e,modalId){if(e&&e.target!==e.currentTarget&&e.target.className!=='close-btn')return;document.getElementById(modalId).style.display='none'}

        // =======================
        // â˜…â˜…â˜… åœ–è¡¨ç¹ªè£½å‡½å¼å€ (æ”¾ç½®æœ€å¾Œ) â˜…â˜…â˜…
        // =======================

        function renderDetailChartsA(row){
            let subLabels=[],subData=[];
            let branchString=row['åˆ†æ”¯è¨ˆç•«']||'';
            if(branchString&&branchString.includes(':')){
                branchString.split('|').forEach(item=>{
                    let parts=item.split(':');
                    if(parts.length===2){subLabels.push(parts[0].trim());subData.push(parseMoney(parts[1].trim()))}
                })
            }
            let pieLabels=[],pieData=[];
            let usageString=row['ç”¨é€”æ¯”ä¾‹']||'';
            if(usageString&&usageString.includes(':')){
                usageString.split('|').forEach(item=>{
                    let parts=item.split(':');
                    if(parts.length===2){pieLabels.push(parts[0].trim());pieData.push(parseInt(parts[1].trim()))}
                })
            }
            const ctxBar=document.getElementById('chartDetailBar').getContext('2d');
            chartBarA=new Chart(ctxBar,{type:'bar',data:{labels:subLabels,datasets:[{label:'é‡‘é¡',data:subData,backgroundColor:'#3498db',borderRadius:4}]},options:{indexAxis:'y',maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:tooltipCurrencyCallback}}});
            const ctxPie=document.getElementById('chartDetailPie').getContext('2d');
            chartPieA=new Chart(ctxPie,{type:'pie',data:{labels:pieLabels,datasets:[{data:pieData,backgroundColor:['#e74c3c','#f1c40f','#2ecc71','#3498db','#95a5a6']}]},options:{maintainAspectRatio:false,plugins:{legend:{position:'bottom'},tooltip:tooltipCurrencyCallback}}});
        }

        function renderDetailChartsB(row){
            const total=parseMoney(row['é ç®—é‡‘é¡']);
            const cut=parseMoney(row['åˆªæ¸›é‡‘é¡']);
            const freeze=parseMoney(row['å‡çµé‡‘é¡']);
            const pass=total-cut-freeze;
            const ctx1=document.getElementById('chartBResult').getContext('2d');
            chartB1=new Chart(ctx1,{type:'bar',data:{labels:['çµæœ'],datasets:[{label:'é€šé',data:[pass],backgroundColor:'#2ecc71'},{label:'å‡çµ',data:[freeze],backgroundColor:'#f1c40f'},{label:'åˆªæ¸›',data:[cut],backgroundColor:'#e74c3c'}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,scales:{x:{stacked:true},y:{stacked:true}},plugins:{tooltip:tooltipCurrencyCallback}}});
            const cCut=parseMoney(row['å§”å“¡æœƒåˆªæ¸›']);const cFreeze=parseMoney(row['å§”å“¡æœƒå‡çµ']);const nCut=parseMoney(row['å”å•†åˆªæ¸›']);const nFreeze=parseMoney(row['å”å•†å‡çµ']);const fCut=parseMoney(row['é™¢æœƒåˆªæ¸›']);const fFreeze=parseMoney(row['é™¢æœƒå‡çµ']);
            const ctx2=document.getElementById('chartBStages').getContext('2d');
            chartB2=new Chart(ctx2,{type:'bar',data:{labels:['å§”å“¡æœƒ','é»¨åœ˜å”å•†','é™¢æœƒ'],datasets:[{label:'åˆªæ¸›',data:[cCut,nCut,fCut],backgroundColor:'#e74c3c'},{label:'å‡çµ',data:[cFreeze,nFreeze,fFreeze],backgroundColor:'#f1c40f'}]},options:{responsive:true,maintainAspectRatio:false,plugins:{tooltip:tooltipCurrencyCallback}}});
        }

        function renderMainCharts(){if(mainChartsRendered)return;new Chart(document.getElementById('chartYearly').getContext('2d'),{type:'bar',data:{labels:['115å¹´åº¦','114å¹´åº¦','113å¹´åº¦','112å¹´åº¦','111å¹´åº¦','110å¹´åº¦','109å¹´åº¦','108å¹´åº¦','107å¹´åº¦','106å¹´åº¦'],datasets:[{label:'æ­²å‡ºç¸½é¡',data:[3034974371000,3132468909000,2881782095000,2719098790000,2262064189000,2161517070000,2102196982000,2022029637000,1991773071000,1997995520000],backgroundColor:'#3498db'}]},options:{responsive:true,maintainAspectRatio:false,plugins:{tooltip:tooltipCurrencyCallback}}});new Chart(document.getElementById('chartAllocation').getContext('2d'),{type:'bar',data:{labels:['115å¹´åº¦é ç®—çµæ§‹'],datasets:[{label:'ç¤¾æœƒç¦åˆ©',data:[831800000000],backgroundColor:'#ff6384'},{label:'æ•™è‚²ç§‘å­¸æ–‡åŒ–',data:[556600000000],backgroundColor:'#36a2eb'},{label:'åœ‹é˜²',data:[548800000000],backgroundColor:'#4bc0c0'},{label:'ç¶“æ¿Ÿç™¼å±•',data:[427500000000],backgroundColor:'#ff9f40'},{label:'ä¸€èˆ¬æ”¿å‹™',data:[302600000000],backgroundColor:'#9966ff'},{label:'é€€ä¼‘æ’«å¹',data:[184400000000],backgroundColor:'#e74c3c'},{label:'å‚µå‹™é‚„æœ¬ä»˜æ¯',data:[106300000000],backgroundColor:'#f1c40f'},{label:'è£œåŠ©åŠå…¶ä»–',data:[50400000000],backgroundColor:'#2ecc71'},{label:'ç¤¾å€ç™¼å±•åŠç’°å¢ƒä¿è­·',data:[26600000000],backgroundColor:'#34495e'}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,scales:{x:{stacked:true,display:false},y:{stacked:true,display:false}},plugins:{tooltip:tooltipCurrencyCallback}}});mainChartsRendered=true}
    </script>
</body>
</html>
